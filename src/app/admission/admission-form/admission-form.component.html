<div class="container mt-4">
  <h2>
    <fa-icon [icon]="isEditMode ? 'pencil' : 'plus'"></fa-icon>
    {{ isEditMode ? "Edit" : "Add" }} Admission Application
  </h2>

  <div class="card mt-3">
    <div class="card-body">
      <ul class="nav nav-pills nav-fill mb-4">
        <li class="nav-item">
          <a
            class="nav-link"
            [class.active]="currentStep === 1"
            href="#"
            (click)="goToStep(1)"
            >Basic Details</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            [class.active]="currentStep === 2"
            href="#"
            (click)="goToStep(2)"
            >Contacts</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            [class.active]="currentStep === 3"
            href="#"
            (click)="goToStep(3)"
            >Documents & Admin</a
          >
        </li>
      </ul>

      <form [formGroup]="admissionForm" (ngSubmit)="onSubmit()">
       <div *ngIf="currentStep === 1">
    <app-basic-details-form
      [basicDetailsForm]="basicDetailsFormGroup" ></app-basic-details-form>
  </div>

  <div *ngIf="currentStep === 2">
    <app-contacts-form
      [contactsForm]="contactsFormGroup" ></app-contacts-form>
  </div>


       <div *ngIf="currentStep === 3">
    <app-documents-form
      [documentsForm]="documentsFormGroup" ></app-documents-form>

          <hr class="my-4" />
          <h4>Admin Specific Fields</h4>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="status" class="form-label"
                >Application Status <span class="text-danger">*</span></label
              >
              <select
                id="status"
                formControlName="status"
                class="form-select"
                [class.is-invalid]="
                  admissionForm.get('status')?.invalid &&
                  admissionForm.get('status')?.touched
                "
              >
                <option
                  *ngFor="let status of applicationStatuses"
                  [value]="status"
                >
                  {{ status }}
                </option>
              </select>
              <div
                *ngIf="
                  admissionForm.get('status')?.invalid &&
                  admissionForm.get('status')?.touched
                "
                class="invalid-feedback"
              >
                Status is required.
              </div>
            </div>
            <div class="col-md-12 mb-3">
              <label for="internalNotes" class="form-label"
                >Internal Notes</label
              >
              <textarea
                id="internalNotes"
                formControlName="internalNotes"
                class="form-control"
                rows="3"
              ></textarea>
            </div>
          </div>
        </div>

        <div
          *ngIf="submissionError"
          class="alert alert-danger mt-3"
          role="alert"
        >
          {{ submissionError }}
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="goToPreviousStep()"
            [disabled]="currentStep === 1"
          >
            <fa-icon icon="arrow-left"></fa-icon> Previous
          </button>

          <div class="d-flex">
            <button
              type="button"
              class="btn btn-secondary me-2"
              (click)="onCancel()"
            >
              <fa-icon icon="times"></fa-icon> Cancel
            </button>

            <button
              type="button"
              class="btn btn-primary me-2"
              (click)="goToNextStep()"
              *ngIf="currentStep < totalSteps"
            >
              Next <fa-icon icon="arrow-right"></fa-icon>
            </button>

            <button
              type="submit"
              class="btn btn-success"
              [disabled]="isLoading"
              *ngIf="currentStep === totalSteps"
            >
              <fa-icon
                [icon]="isLoading ? 'spinner' : 'save'"
                spin
              ></fa-icon>
              {{
                isLoading
                  ? "Saving..."
                  : isEditMode
                  ? "Update Application"
                  : "Add Application"
              }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
